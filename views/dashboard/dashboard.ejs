<% layout("layouts/boilerplate") %>
<% block('title',"Dashboard: ")%>

<!-- <div class="container my-5 pb-5"> -->
  <h2 class="mb-4 text-center">Dashboard</h2>
  <!-- <div class="row g-4">
    <div class="col-md-4">
      <div class="card shadow dashboard-card text-center">
        <div class="card-body">
          <i class="fa-solid fa-book fa-2x mb-3 text-primary"></i>
          <h5 class="card-title">Total Study Units</h5>
          <p class="card-text display-6">12</p>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card shadow dashboard-card text-center">
        <div class="card-body">
          <i class="fa-solid fa-list-check fa-2x mb-3 text-success"></i>
          <h5 class="card-title">Topics Completed</h5>
          <p class="card-text display-6">34</p>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card shadow dashboard-card text-center">
        <div class="card-body">
          <i class="fa-solid fa-clipboard-question fa-2x mb-3 text-warning"></i>
          <h5 class="card-title">Quizzes Taken</h5>
          <p class="card-text display-6">8</p>
        </div>
      </div>
    </div>
  </div> -->
<!-- </div> -->

<!-- Quiz Results -->
<section class="mt-5">
  <div class="card shadow">
    <div class="card-header bg-black text-white">
      <h4 class="mb-0 text-center align-middle">Recent Quiz Results</h4>
    </div>
    <div class="card-body p-0">
      <table class="table table-striped table-hover mb-0 text-center align-middle" >
        <thead class="table-light">
          <tr>
            <th>Study Unit</th>
            <th>Topic</th>
            <th>Score</th>
            <th>Percentage</th>
            <th>Date</th>
          </tr>
        <thead>
        <tbody>
          <% quizWithTopics.forEach(quiz => { %>
          <tr>
            <td><%= quiz.studyUnitName %></td>
            <td><%= quiz.topicName %></td>
            <td><%= quiz.score %> / 5</td>
            <td><%= ((quiz.score / 5) * 100).toFixed(1) %>%</td>
            <td><%= new Date(quiz.takenAt).toLocaleString('en-IN', { timeZone: 'Asia/Kolkata' }) %></td>
         </tr>
         <% }) %>
        </tbody>  
      </table>
    </div>
  </div>
</section>



<!-- Review Schedule -->
<section class="mt-5">
  <div class="card shadow">
    <div class="card-header bg-warning text-dark">
      <h4 class="mb-0 text-center align-middle">Review Schedule</h4>
    </div>
    <div class="card-body p-0">
      <table class="table table-striped table-hover mb-0 text-center align-middle">
       <thead class="table-light">
          <tr>
             <th>Study Unit</th>
             <th>Topic</th>
             <th>Next Review (IST)</th>
             <th>Status</th>
          </tr>
      </thead> 
      <tbody>
        <% reviewWithTopics.forEach(review => { 
          const now = new Date();
          const nextDate = new Date(review.nextReviewDate);
          const istDate = nextDate.toLocaleString('en-IN', { timeZone: 'Asia/Kolkata' });
          const status = nextDate <= now ? "Due Today" : "Upcoming";
        %>
       <tr>
          <td><%= review.studyUnitName %></td>
          <td><%= review.topicName %></td>
          <td><%= istDate %></td>
          <td>
            <span class="badge <%= status === 'Due Today' ? 'bg-danger' : 'bg-info text-dark' %>">
               <%= status %>
            </span>
          </td>
      </tr>
     <% }) %>
    </tbody>
  </table>
  </div>
  </div>
  
</section>

